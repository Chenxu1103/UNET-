# ç”µç¼†ç»•åŒ…è´¨é‡æ£€æµ‹ç³»ç»Ÿ

åŸºäºæ·±åº¦å­¦ä¹ çš„ç”µç¼†ç»•åŒ…è´¨é‡å®æ—¶æ£€æµ‹ç³»ç»Ÿï¼Œæ”¯æŒç”µç¼†ã€èƒ¶å¸¦åˆ†å‰²å’Œæ¯›åˆºç¼ºé™·æ£€æµ‹ã€‚

## ğŸ¯ æœ€ä½³æ£€æµ‹æ•ˆæœ

**å‚è€ƒè§†é¢‘**: `20200526_015047_030746.mp4` (800x448åˆ†è¾¨ç‡)

![37c6b896e3af435b41a8dcdf869ff010](https://github.com/user-attachments/assets/84383ce0-6a31-4541-82a4-afed6a9e3c79)
<img width="1912" height="991" alt="image" src="https://github.com/user-attachments/assets/07bf7e45-0f7c-4ac4-b2f2-932a37aaa336" />


**æ£€æµ‹æ€§èƒ½**:
- âœ… **ç”µç¼†æ£€æµ‹**: 0%-59% (æ¸…æ™°è¯†åˆ«è£¸ç”µç¼†æ®µ)
- âœ… **èƒ¶å¸¦æ£€æµ‹**: 0%-60% (å‡†ç¡®è¯†åˆ«èƒ¶å¸¦åŒ…è£¹æ®µ)
- âœ… **æ¯›åˆºæ£€æµ‹**: 0å¸§è¯¯æ£€ (æ— å‡é˜³æ€§)
- âœ… **å¤„ç†é€Ÿåº¦**: 14.59 FPS (å®æ—¶å¤„ç†)
- âœ… **æ£€æµ‹æ¨¡å¼**: æ¸…æ™°çš„ç»•åŒ…è¿‡ç¨‹è¯†åˆ«
  - å¸§60-600: è£¸ç”µç¼†æ®µ (é«˜ç”µç¼†42-47%, ä½èƒ¶å¸¦0-4%)
  - å¸§660-1680: èƒ¶å¸¦åŒ…è£¹æ®µ (ä½ç”µç¼†0-36%, é«˜èƒ¶å¸¦12-48%)
  - å¸§1740-2040: è¿‡æ¸¡å›è£¸ç”µç¼†
  - å¸§2100-2520: ç»“æŸæ®µ

## é¡¹ç›®ç‰¹ç‚¹

- âœ… **é«˜ç²¾åº¦åˆ†å‰²**ï¼šåŸºäºUNet++çš„ç”µç¼†/èƒ¶å¸¦è¯­ä¹‰åˆ†å‰²ï¼ˆmIoU 79.97%ï¼‰
- âœ… **æ¯›åˆºæ£€æµ‹**ï¼šå¤šå°ºåº¦è¾¹ç¼˜èåˆç®—æ³•ï¼Œå‡†ç¡®è¯†åˆ«ç”µç¼†è¡¨é¢æ¯›åˆº
- âœ… **å›¾åƒå¢å¼º**ï¼šCLAHE+å»å™ª+é”åŒ–ï¼Œé€‚åº”ä½å…‰ç…§ç¯å¢ƒ
- âœ… **ROIæ£€æµ‹**ï¼šæ”¯æŒè‡ªå®šä¹‰ROIï¼Œå‡å°‘èƒŒæ™¯å¹²æ‰°
- âœ… **å¤šåˆ†è¾¨ç‡æ”¯æŒ**ï¼šè‡ªåŠ¨å½’ä¸€åŒ–ä¸åŒåˆ†è¾¨ç‡è§†é¢‘
- âœ… **å®æ—¶å¤„ç†**ï¼šGPUåŠ é€Ÿï¼Œ10-15 FPS

## ç³»ç»Ÿæ¶æ„

```
ç”µç¼†ç»•åŒ…æ£€æµ‹ç³»ç»Ÿ
â”œâ”€â”€ é˜¶æ®µ1: ç”µç¼†/èƒ¶å¸¦åˆ†å‰²ï¼ˆUNet++æ¨¡å‹ï¼‰
â”œâ”€â”€ é˜¶æ®µ2: æ¯›åˆºæ£€æµ‹ï¼ˆè§„åˆ™æ³•+è¾¹ç¼˜æ£€æµ‹ï¼‰
â””â”€â”€ é˜¶æ®µ3: ç»“æœå¯è§†åŒ–ä¸ç»Ÿè®¡
```

## ç¯å¢ƒè¦æ±‚

- Python 3.8+
- PyTorch 1.10+
- CUDA 11.0+ (GPUåŠ é€Ÿ)
- OpenCV 4.5+

## å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Chenxu1103/UNET-.git
cd UNET-

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv gpu_env
source gpu_env/bin/activate  # Windows: gpu_env\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

## å¿«é€Ÿå¼€å§‹

### 1. æ ‡å‡†åˆ†è¾¨ç‡è§†é¢‘æ£€æµ‹ï¼ˆ800x448ï¼‰

```bash
python infer_two_stage_burr.py \
  --video data/raw/video.mp4 \
  --model checkpoints_3class_advanced/best_model.pth \
  --output log/output \
  --device cuda
```

### 2. é«˜åˆ†è¾¨ç‡è§†é¢‘æ£€æµ‹ï¼ˆè‡ªåŠ¨å½’ä¸€åŒ–ï¼‰

```bash
python infer_two_stage_burr.py \
  --video data/raw/high_res_video.avi \
  --model checkpoints_3class_advanced/best_model.pth \
  --output log/output \
  --device cuda \
  --rotate \
  --normalize-resolution \
  --target-width 800 \
  --target-height 448
```

### 3. å¢å¼ºç‰ˆæ¯›åˆºæ£€æµ‹ï¼ˆå›¾åƒå¢å¼ºï¼‰

```bash
python infer_enhanced_burr.py \
  --video data/raw/video.avi \
  --model checkpoints_3class_advanced/best_model.pth \
  --output log/output \
  --device cuda \
  --enhance
```

### 4. è‡ªå®šä¹‰ROIæ£€æµ‹

```bash
python infer_high_res_custom_roi.py \
  --video data/raw/video.avi \
  --model checkpoints_3class_advanced/best_model.pth \
  --output log/output \
  --device cuda
```

## é¡¹ç›®ç»“æ„

```
cable-wrapping-detection/
â”œâ”€â”€ src/                          # æºä»£ç 
â”‚   â”œâ”€â”€ models/                   # æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ unetpp.py            # UNet++æ¨¡å‹
â”‚   â”‚   â””â”€â”€ losses.py            # æŸå¤±å‡½æ•°
â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ geometry_enhanced.py  # å‡ ä½•æµ‹é‡
â”œâ”€â”€ data/                         # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ raw/                     # åŸå§‹è§†é¢‘
â”‚   â””â”€â”€ labelme/                 # æ ‡æ³¨æ•°æ®
â”œâ”€â”€ tools/                        # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ extract_frames.py       # å¸§æå–
â”‚   â”œâ”€â”€ calibrate_roi.py        # ROIæ ‡å®š
â”‚   â””â”€â”€ train.py                # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ infer_two_stage_burr.py      # ä¸»æ£€æµ‹è„šæœ¬
â”œâ”€â”€ infer_enhanced_burr.py       # å¢å¼ºç‰ˆæ£€æµ‹
â”œâ”€â”€ infer_high_res_custom_roi.py # è‡ªå®šä¹‰ROIæ£€æµ‹
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. ç”µç¼†/èƒ¶å¸¦åˆ†å‰²

ä½¿ç”¨UNet++æ¨¡å‹è¿›è¡Œè¯­ä¹‰åˆ†å‰²ï¼š
- è¾“å…¥ï¼š512x512 RGBå›¾åƒ
- è¾“å‡ºï¼š3ç±»åˆ†å‰²ï¼ˆèƒŒæ™¯ã€ç”µç¼†ã€èƒ¶å¸¦ï¼‰
- æ€§èƒ½ï¼šmIoU 79.97%

### 2. æ¯›åˆºæ£€æµ‹

å¤šå°ºåº¦è¾¹ç¼˜èåˆç®—æ³•ï¼š
- Cannyè¾¹ç¼˜æ£€æµ‹
- Sobelè¾¹ç¼˜æ£€æµ‹
- Laplacianè¾¹ç¼˜æ£€æµ‹
- å½¢æ€å­¦è¿‡æ»¤
- è¿é€šåŸŸåˆ†æ

### 3. å›¾åƒå¢å¼º

é’ˆå¯¹ä½å…‰ç…§ç¯å¢ƒçš„å¢å¼ºï¼š
- CLAHEï¼ˆå¯¹æ¯”åº¦é™åˆ¶è‡ªé€‚åº”ç›´æ–¹å›¾å‡è¡¡åŒ–ï¼‰
- éå±€éƒ¨å‡å€¼å»å™ª
- é”åŒ–æ»¤æ³¢

### 4. ROIæ£€æµ‹

æ”¯æŒè‡ªå®šä¹‰ROIé…ç½®ï¼š
- å›ºå®šROIåæ ‡
- è‡ªåŠ¨åˆ†è¾¨ç‡æ˜ å°„
- ROIå¤–åŒºåŸŸé®ç½©

## æ£€æµ‹ç»“æœ

### å‚è€ƒè§†é¢‘ï¼ˆ800x448ï¼‰

- ç”µç¼†æ£€æµ‹ï¼š0%-59%
- èƒ¶å¸¦æ£€æµ‹ï¼š0%-60%
- æ¯›åˆºæ£€æµ‹ï¼š0å¸§ï¼ˆæ— è¯¯æ£€ï¼‰
- å¤„ç†é€Ÿåº¦ï¼š14.59 FPS

### é«˜åˆ†è¾¨ç‡è§†é¢‘ï¼ˆ2448x2048 â†’ 800x448ï¼‰

- ç”µç¼†æ£€æµ‹ï¼š0%-10%
- èƒ¶å¸¦æ£€æµ‹ï¼š0%-0.1%
- æ¯›åˆºæ£€æµ‹ï¼š22å¸§ï¼ˆ0.9%ï¼‰
- å¤„ç†é€Ÿåº¦ï¼š10.66 FPS

## æ¨¡å‹è®­ç»ƒ

### æ•°æ®å‡†å¤‡

```bash
# æå–è§†é¢‘å¸§
python tools/extract_frames.py --video data/raw/video.mp4 --output data/frames

# ä½¿ç”¨labelmeæ ‡æ³¨
labelme data/frames

# è½¬æ¢æ ‡æ³¨æ•°æ®
python data/prepare_dataset_cli.py --input data/labelme --output dataset/processed
```

### è®­ç»ƒæ¨¡å‹

```bash
python tools/train.py \
  --dataset dataset/processed \
  --output checkpoints \
  --epochs 100 \
  --batch-size 8 \
  --lr 0.001
```

## å‚æ•°è¯´æ˜

### ä¸»è¦å‚æ•°

- `--video`: è¾“å…¥è§†é¢‘è·¯å¾„
- `--model`: æ¨¡å‹æƒé‡è·¯å¾„
- `--output`: è¾“å‡ºç›®å½•
- `--device`: è®¡ç®—è®¾å¤‡ï¼ˆcuda/cpuï¼‰
- `--rotate`: æ—‹è½¬è§†é¢‘90åº¦
- `--normalize-resolution`: å¯ç”¨åˆ†è¾¨ç‡å½’ä¸€åŒ–
- `--enhance`: å¯ç”¨å›¾åƒå¢å¼º
- `--burr-sensitivity`: æ¯›åˆºæ£€æµ‹çµæ•åº¦ï¼ˆlow/medium/highï¼‰

### ROIé…ç½®

åœ¨è„šæœ¬ä¸­ä¿®æ”¹ROIåæ ‡ï¼š

```python
CUSTOM_ROI = {
    'x1': 250,   # å·¦è¾¹ç•Œ
    'y1': 0,     # ä¸Šè¾¹ç•Œ
    'x2': 550,   # å³è¾¹ç•Œ
    'y2': 448    # ä¸‹è¾¹ç•Œ
}
```

## æ€§èƒ½ä¼˜åŒ–

- GPUåŠ é€Ÿï¼šä½¿ç”¨CUDAè¿›è¡Œæ¨¡å‹æ¨ç†
- æ‰¹å¤„ç†ï¼šæ”¯æŒæ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘
- å¤šçº¿ç¨‹ï¼šè§†é¢‘è¯»å–ä¸æ¨ç†å¹¶è¡Œ
- æ¨¡å‹é‡åŒ–ï¼šæ”¯æŒINT8é‡åŒ–ï¼ˆRV1126éƒ¨ç½²ï¼‰

## éƒ¨ç½²

### RV1126ç¯å¢ƒéƒ¨ç½²

```bash
# è½¬æ¢æ¨¡å‹ä¸ºONNXæ ¼å¼
python tools/export_onnx.py --model checkpoints/best_model.pth --output model.onnx

# è½¬æ¢ä¸ºRKNNæ ¼å¼
python tools/convert_rknn.py --onnx model.onnx --output model.rknn
```

## å¸¸è§é—®é¢˜

### Q: æ£€æµ‹æ•ˆæœå·®æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ROIæ˜¯å¦æ­£ç¡®æ¡†ä½ç”µç¼†åŒºåŸŸ
2. è§†é¢‘åˆ†è¾¨ç‡æ˜¯å¦ä¸è®­ç»ƒæ•°æ®åŒ¹é…
3. å…‰ç…§æ¡ä»¶æ˜¯å¦ç›¸ä¼¼
4. å°è¯•å¯ç”¨å›¾åƒå¢å¼ºï¼ˆ--enhanceï¼‰

### Q: å¦‚ä½•è°ƒæ•´ROIï¼Ÿ

A: ä½¿ç”¨ROIæ ‡å®šå·¥å…·ï¼š
```bash
python tools/calibrate_roi.py --video data/raw/video.mp4 --output roi.json
```

### Q: å¦‚ä½•æé«˜æ£€æµ‹é€Ÿåº¦ï¼Ÿ

A:
1. ä½¿ç”¨GPUåŠ é€Ÿï¼ˆ--device cudaï¼‰
2. é™ä½è¾“å…¥åˆ†è¾¨ç‡
3. å‡å°‘å¸§ç‡ï¼ˆ--frame-stride 2ï¼‰

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–Pull Requestã€‚

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-02-03)

- âœ… å®ç°UNet++ç”µç¼†/èƒ¶å¸¦åˆ†å‰²
- âœ… å®ç°å¤šå°ºåº¦æ¯›åˆºæ£€æµ‹ç®—æ³•
- âœ… æ”¯æŒå›¾åƒå¢å¼ºå¤„ç†
- âœ… æ”¯æŒå¤šåˆ†è¾¨ç‡è§†é¢‘
- âœ… æ”¯æŒè‡ªå®šä¹‰ROIé…ç½®
- âœ… å®Œæ•´çš„æ£€æµ‹æµç¨‹å’Œå¯è§†åŒ–
